---
title: 'T√°ch bi·ªát s·ª± ki·ªán v√† Effect'
---

<Intro>

Event handler ch·ªâ ch·∫°y l·∫°i khi b·∫°n th·ª±c hi·ªán l·∫°i c√πng m·ªôt t∆∞∆°ng t√°c. Kh√°c v·ªõi event handler, Effect s·∫Ω ƒë·ªìng b·ªô l·∫°i n·∫øu m·ªôt gi√° tr·ªã m√† n√≥ ƒë·ªçc, nh∆∞ m·ªôt prop ho·∫∑c m·ªôt bi·∫øn state, kh√°c v·ªõi gi√° tr·ªã ·ªü l·∫ßn render tr∆∞·ªõc. ƒê√¥i khi, b·∫°n c≈©ng mu·ªën k·∫øt h·ª£p c·∫£ hai h√†nh vi: m·ªôt Effect ch·∫°y l·∫°i khi m·ªôt s·ªë gi√° tr·ªã thay ƒë·ªïi nh∆∞ng kh√¥ng ph·∫£i t·∫•t c·∫£. Trang n√†y s·∫Ω h∆∞·ªõng d·∫´n b·∫°n c√°ch l√†m ƒëi·ªÅu ƒë√≥.

</Intro>

<YouWillLearn>

- C√°ch l·ª±a ch·ªçn gi·ªØa event handler v√† Effect
- V√¨ sao Effect l√† reactive, c√≤n event handler th√¨ kh√¥ng
- L√†m g√¨ khi b·∫°n mu·ªën m·ªôt ph·∫ßn code trong Effect kh√¥ng b·ªã reactive
- Effect Event l√† g√¨, v√† c√°ch t√°ch ch√∫ng ra kh·ªèi Effect
- C√°ch ƒë·ªçc gi√° tr·ªã props v√† state m·ªõi nh·∫•t t·ª´ Effect b·∫±ng Effect Event

</YouWillLearn>

## L·ª±a ch·ªçn gi·ªØa event handler v√† Effect {/*choosing-between-event-handlers-and-effects*/}

Tr∆∞·ªõc ti√™n, h√£y c√πng √¥n l·∫°i s·ª± kh√°c bi·ªát gi·ªØa event handler v√† Effect.

H√£y t∆∞·ªüng t∆∞·ª£ng b·∫°n ƒëang tri·ªÉn khai m·ªôt component ph√≤ng chat. Y√™u c·∫ßu c·ªßa b·∫°n nh∆∞ sau:

1. Component c·ªßa b·∫°n n√™n t·ª± ƒë·ªông k·∫øt n·ªëi t·ªõi ph√≤ng chat ƒë∆∞·ª£c ch·ªçn.
1. Khi b·∫°n nh·∫•n n√∫t "Send", n√≥ s·∫Ω g·ª≠i tin nh·∫Øn t·ªõi ph√≤ng chat.

Gi·∫£ s·ª≠ b·∫°n ƒë√£ tri·ªÉn khai code cho ch√∫ng, nh∆∞ng b·∫°n kh√¥ng ch·∫Øc n√™n ƒë·∫∑t ·ªü ƒë√¢u. B·∫°n n√™n d√πng event handler hay Effect? M·ªói khi c·∫ßn tr·∫£ l·ªùi c√¢u h·ªèi n√†y, h√£y c√¢n nh·∫Øc [*v√¨ sao* ƒëo·∫°n code ƒë√≥ c·∫ßn ch·∫°y.](/learn/synchronizing-with-effects#what-are-effects-and-how-are-they-different-from-events)

### Event handler ch·∫°y ƒë·ªÉ ph·∫£n h·ªìi c√°c t∆∞∆°ng t√°c c·ª• th·ªÉ {/*event-handlers-run-in-response-to-specific-interactions*/}

T·ª´ g√≥c nh√¨n c·ªßa ng∆∞·ªùi d√πng, vi·ªác g·ª≠i tin nh·∫Øn ch·ªâ n√™n x·∫£y ra *b·ªüi v√¨* n√∫t "Send" c·ª• th·ªÉ ƒë√£ ƒë∆∞·ª£c nh·∫•n. Ng∆∞·ªùi d√πng s·∫Ω r·∫•t kh√≥ ch·ªãu n·∫øu b·∫°n g·ª≠i tin nh·∫Øn c·ªßa h·ªç v√†o b·∫•t k·ª≥ th·ªùi ƒëi·ªÉm n√†o kh√°c ho·∫∑c v√¨ l√Ω do n√†o kh√°c. ƒê√≥ l√† l√Ω do g·ª≠i tin nh·∫Øn n√™n l√† m·ªôt event handler. Event handler cho ph√©p b·∫°n x·ª≠ l√Ω c√°c t∆∞∆°ng t√°c c·ª• th·ªÉ:

```js {4-6}
function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');
  // ...
  function handleSendClick() {
    sendMessage(message);
  }
  // ...
  return (
    <>
      <input value={message} onChange={e => setMessage(e.target.value)} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}
```

V·ªõi event handler, b·∫°n c√≥ th·ªÉ ch·∫Øc ch·∫Øn r·∫±ng `sendMessage(message)` s·∫Ω *ch·ªâ* ch·∫°y n·∫øu ng∆∞·ªùi d√πng nh·∫•n n√∫t.

### Effect ch·∫°y b·∫•t c·ª© khi n√†o c·∫ßn ƒë·ªìng b·ªô h√≥a {/*effects-run-whenever-synchronization-is-needed*/}

H√£y nh·ªõ r·∫±ng b·∫°n c≈©ng c·∫ßn gi·ªØ cho component lu√¥n k·∫øt n·ªëi v·ªõi ph√≤ng chat. ƒêo·∫°n code ƒë√≥ n√™n ƒë·∫∑t ·ªü ƒë√¢u?

*L√Ω do* ƒë·ªÉ ch·∫°y ƒëo·∫°n code n√†y kh√¥ng ph·∫£i l√† m·ªôt t∆∞∆°ng t√°c c·ª• th·ªÉ n√†o. Kh√¥ng quan tr·ªçng v√¨ sao ho·∫∑c b·∫±ng c√°ch n√†o ng∆∞·ªùi d√πng ƒëi·ªÅu h∆∞·ªõng t·ªõi m√†n h√¨nh ph√≤ng chat. Khi h·ªç ƒëang xem n√≥ v√† c√≥ th·ªÉ t∆∞∆°ng t√°c, component c·∫ßn gi·ªØ k·∫øt n·ªëi v·ªõi server chat ƒë√£ ch·ªçn. Ngay c·∫£ khi component ph√≤ng chat l√† m√†n h√¨nh ƒë·∫ßu ti√™n c·ªßa ·ª©ng d·ª•ng, v√† ng∆∞·ªùi d√πng ch∆∞a th·ª±c hi·ªán b·∫•t k·ª≥ t∆∞∆°ng t√°c n√†o, b·∫°n *v·∫´n* c·∫ßn k·∫øt n·ªëi. ƒê√≥ l√† l√Ω do n√≥ n√™n l√† m·ªôt Effect:

```js {3-9}
function ChatRoom({ roomId }) {
  // ...
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect();
    };
  }, [roomId]);
  // ...
}
```

V·ªõi ƒëo·∫°n code n√†y, b·∫°n c√≥ th·ªÉ ch·∫Øc ch·∫Øn r·∫±ng lu√¥n c√≥ m·ªôt k·∫øt n·ªëi ho·∫°t ƒë·ªông t·ªõi server chat hi·ªán t·∫°i, *b·∫•t k·ªÉ* ng∆∞·ªùi d√πng ƒë√£ th·ª±c hi·ªán nh·ªØng t∆∞∆°ng t√°c n√†o. D√π ng∆∞·ªùi d√πng ch·ªâ v·ª´a m·ªü app, ch·ªçn ph√≤ng kh√°c, hay ƒëi·ªÅu h∆∞·ªõng sang m√†n h√¨nh kh√°c r·ªìi quay l·∫°i, Effect c·ªßa b·∫°n ƒë·∫£m b·∫£o component s·∫Ω *lu√¥n ƒë·ªìng b·ªô* v·ªõi ph√≤ng hi·ªán t·∫°i, v√† s·∫Ω [k·∫øt n·ªëi l·∫°i khi c·∫ßn thi·∫øt.](/learn/lifecycle-of-reactive-effects#why-synchronization-may-need-to-happen-more-than-once)

<Sandpack>

```js
import { useState, useEffect } from 'react';
import { createConnection, sendMessage } from './chat.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  function handleSendClick() {
    sendMessage(message);
  }

  return (
    <>
      <h1>Welcome to the {roomId} room!</h1>
      <input value={message} onChange={e => setMessage(e.target.value)} />
      <button onClick={handleSendClick}>Send</button>
    </>
  );
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [show, setShow] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <button onClick={() => setShow(!show)}>
        {show ? 'Close chat' : 'Open chat'}
      </button>
      {show && <hr />}
      {show && <ChatRoom roomId={roomId} />}
    </>
  );
}
```

```js src/chat.js
export function sendMessage(message) {
  console.log('üîµ You sent: ' + message);
}

export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  return {
    connect() {
      console.log('‚úÖ Connecting to "' + roomId + '" room at ' + serverUrl + '...');
    },
    disconnect() {
      console.log('‚ùå Disconnected from "' + roomId + '" room at ' + serverUrl);
    }
  };
}
```

```css
input, select { margin-right: 20px; }
```

</Sandpack>

## Gi√° tr·ªã reactive v√† logic reactive {/*reactive-values-and-reactive-logic*/}

M·ªôt c√°ch tr·ª±c quan, b·∫°n c√≥ th·ªÉ n√≥i r·∫±ng event handler lu√¥n ƒë∆∞·ª£c k√≠ch ho·∫°t "th·ªß c√¥ng", v√≠ d·ª• nh∆∞ khi nh·∫•n m·ªôt n√∫t. Ng∆∞·ª£c l·∫°i, Effect l√† "t·ª± ƒë·ªông": ch√∫ng s·∫Ω ch·∫°y v√† ch·∫°y l·∫°i khi c·∫ßn ƒë·ªÉ gi·ªØ cho m·ªçi th·ª© ƒë·ªìng b·ªô.

C√≥ m·ªôt c√°ch ch√≠nh x√°c h∆°n ƒë·ªÉ suy nghƒ© v·ªÅ ƒëi·ªÅu n√†y.

Props, state, v√† c√°c bi·∫øn ƒë∆∞·ª£c khai b√°o b√™n trong th√¢n component c·ªßa b·∫°n ƒë∆∞·ª£c g·ªçi l√† <CodeStep step={2}>gi√° tr·ªã reactive</CodeStep>. Trong v√≠ d·ª• n√†y, `serverUrl` kh√¥ng ph·∫£i l√† gi√° tr·ªã reactive, nh∆∞ng `roomId` v√† `message` th√¨ c√≥. Ch√∫ng tham gia v√†o lu·ªìng d·ªØ li·ªáu khi render:

```js [[2, 3, "roomId"], [2, 4, "message"]]
const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId }) {
  const [message, setMessage] = useState('');

  // ...
}
```

Nh·ªØng gi√° tr·ªã reactive nh∆∞ v·∫≠y c√≥ th·ªÉ thay ƒë·ªïi do m·ªôt l·∫ßn render l·∫°i. V√≠ d·ª•, ng∆∞·ªùi d√πng c√≥ th·ªÉ ch·ªânh s·ª≠a `message` ho·∫∑c ch·ªçn m·ªôt `roomId` kh√°c trong dropdown. Event handler v√† Effect ph·∫£n h·ªìi s·ª± thay ƒë·ªïi n√†y theo c√°ch kh√°c nhau:

- **Logic b√™n trong event handler *kh√¥ng ph·∫£i l√† reactive.*** N√≥ s·∫Ω kh√¥ng ch·∫°y l·∫°i tr·ª´ khi ng∆∞·ªùi d√πng th·ª±c hi·ªán l·∫°i c√πng m·ªôt t∆∞∆°ng t√°c (v√≠ d·ª•: click). Event handler c√≥ th·ªÉ ƒë·ªçc gi√° tr·ªã reactive m√† kh√¥ng "ph·∫£n ·ª©ng" v·ªõi s·ª± thay ƒë·ªïi c·ªßa ch√∫ng.
- **Logic b√™n trong Effect *l√† reactive.*** N·∫øu Effect c·ªßa b·∫°n ƒë·ªçc m·ªôt gi√° tr·ªã reactive, [b·∫°n ph·∫£i khai b√°o n√≥ l√† dependency.](/learn/lifecycle-of-reactive-effects#effects-react-to-reactive-values) Khi m·ªôt l·∫ßn render l·∫°i l√†m gi√° tr·ªã ƒë√≥ thay ƒë·ªïi, React s·∫Ω ch·∫°y l·∫°i logic c·ªßa Effect v·ªõi gi√° tr·ªã m·ªõi.

H√£y xem l·∫°i v√≠ d·ª• tr∆∞·ªõc ƒë·ªÉ minh h·ªça s·ª± kh√°c bi·ªát n√†y.

### Logic b√™n trong event handler kh√¥ng ph·∫£i l√† reactive {/*logic-inside-event-handlers-is-not-reactive*/}

Xem d√≤ng code n√†y. Logic n√†y c√≥ n√™n l√† reactive kh√¥ng?

```js [[2, 2, "message"]]
    // ...
    sendMessage(message);
    // ...
```

T·ª´ g√≥c nh√¨n c·ªßa ng∆∞·ªùi d√πng, **vi·ªác thay ƒë·ªïi `message` _kh√¥ng_ c√≥ nghƒ©a l√† h·ªç mu·ªën g·ª≠i tin nh·∫Øn.** N√≥ ch·ªâ c√≥ nghƒ©a l√† ng∆∞·ªùi d√πng ƒëang g√µ. N√≥i c√°ch kh√°c, logic g·ª≠i tin nh·∫Øn kh√¥ng n√™n l√† reactive. N√≥ kh√¥ng n√™n ch·∫°y l·∫°i ch·ªâ v√¨ <CodeStep step={2}>gi√° tr·ªã reactive</CodeStep> ƒë√£ thay ƒë·ªïi. ƒê√≥ l√† l√Ω do n√≥ thu·ªôc v·ªÅ event handler:

```js {2}
  function handleSendClick() {
    sendMessage(message);
  }
```

Event handler kh√¥ng ph·∫£i l√† reactive, n√™n `sendMessage(message)` ch·ªâ ch·∫°y khi ng∆∞·ªùi d√πng nh·∫•n n√∫t Send.

### Logic b√™n trong Effect l√† reactive {/*logic-inside-effects-is-reactive*/}

B√¢y gi·ªù h√£y quay l·∫°i c√°c d√≤ng n√†y:

```js [[2, 2, "roomId"]]
    // ...
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    // ...
```

T·ª´ g√≥c nh√¨n c·ªßa ng∆∞·ªùi d√πng, **vi·ªác thay ƒë·ªïi `roomId` *c√≥ nghƒ©a* l√† h·ªç mu·ªën k·∫øt n·ªëi t·ªõi ph√≤ng kh√°c.** N√≥i c√°ch kh√°c, logic k·∫øt n·ªëi t·ªõi ph√≤ng n√™n l√† reactive. B·∫°n *mu·ªën* c√°c d√≤ng code n√†y "theo s√°t" <CodeStep step={2}>gi√° tr·ªã reactive</CodeStep>, v√† ch·∫°y l·∫°i n·∫øu gi√° tr·ªã ƒë√≥ thay ƒë·ªïi. ƒê√≥ l√† l√Ω do n√≥ n√™n n·∫±m trong m·ªôt Effect:

```js {2-3}
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.connect();
    return () => {
      connection.disconnect()
    };
  }, [roomId]);
```

Effect l√† reactive, n√™n `createConnection(serverUrl, roomId)` v√† `connection.connect()` s·∫Ω ch·∫°y cho m·ªói gi√° tr·ªã kh√°c nhau c·ªßa `roomId`. Effect c·ªßa b·∫°n gi·ªØ cho k·∫øt n·ªëi chat lu√¥n ƒë·ªìng b·ªô v·ªõi ph√≤ng hi·ªán t·∫°i.

## T√°ch logic kh√¥ng reactive ra kh·ªèi Effect {/*extracting-non-reactive-logic-out-of-effects*/}

M·ªçi th·ª© tr·ªü n√™n ph·ª©c t·∫°p h∆°n khi b·∫°n mu·ªën k·∫øt h·ª£p logic reactive v·ªõi logic kh√¥ng reactive.

V√≠ d·ª•, h√£y t∆∞·ªüng t∆∞·ª£ng b·∫°n mu·ªën hi·ªÉn th·ªã th√¥ng b√°o khi ng∆∞·ªùi d√πng k·∫øt n·ªëi t·ªõi chat. B·∫°n ƒë·ªçc theme hi·ªán t·∫°i (t·ªëi ho·∫∑c s√°ng) t·ª´ props ƒë·ªÉ c√≥ th·ªÉ hi·ªÉn th·ªã th√¥ng b√°o v·ªõi m√†u ƒë√∫ng:

```js {1,4-6}
function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    // ...
```

Tuy nhi√™n, `theme` l√† m·ªôt gi√° tr·ªã reactive (n√≥ c√≥ th·ªÉ thay ƒë·ªïi do render l·∫°i), v√† [m·ªçi gi√° tr·ªã reactive ƒë∆∞·ª£c ƒë·ªçc b·ªüi Effect ph·∫£i ƒë∆∞·ª£c khai b√°o l√†m dependency.](/learn/lifecycle-of-reactive-effects#react-verifies-that-you-specified-every-reactive-value-as-a-dependency) B√¢y gi·ªù b·∫°n ph·∫£i khai b√°o `theme` l√† dependency c·ªßa Effect:

```js {5,11}
function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    return () => {
      connection.disconnect()
    };
  }, [roomId, theme]); // ‚úÖ All dependencies declared
  // ...
```

Th·ª≠ v·ªõi v√≠ d·ª• n√†y v√† xem b·∫°n c√≥ th·ªÉ ph√°t hi·ªán v·∫•n ƒë·ªÅ v·ªõi tr·∫£i nghi·ªám ng∆∞·ªùi d√πng n√†y kh√¥ng:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "latest",
    "react-dom": "latest",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      showNotification('Connected!', theme);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId, theme]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}
```

```js src/notifications.js
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label { display: block; margin-top: 10px; }
```

</Sandpack>

Khi `roomId` thay ƒë·ªïi, chat s·∫Ω k·∫øt n·ªëi l·∫°i nh∆∞ b·∫°n mong ƒë·ª£i. Nh∆∞ng v√¨ `theme` c≈©ng l√† m·ªôt dependency, chat *c≈©ng* k·∫øt n·ªëi l·∫°i m·ªói khi b·∫°n chuy·ªÉn gi·ªØa theme t·ªëi v√† s√°ng. ƒêi·ªÅu ƒë√≥ kh√¥ng t·ªët!

N√≥i c√°ch kh√°c, b·∫°n *kh√¥ng* mu·ªën d√≤ng n√†y l√† reactive, m·∫∑c d√π n√≥ n·∫±m trong m·ªôt Effect (v·ªën l√† reactive):

```js
      // ...
      showNotification('Connected!', theme);
      // ...
```

B·∫°n c·∫ßn m·ªôt c√°ch ƒë·ªÉ t√°ch logic kh√¥ng reactive n√†y ra kh·ªèi Effect reactive xung quanh n√≥.

### Khai b√°o Effect Event {/*declaring-an-effect-event*/}

<Wip>

Ph·∫ßn n√†y m√¥ t·∫£ m·ªôt **API th·ª≠ nghi·ªám ch∆∞a ƒë∆∞·ª£c ph√°t h√†nh** trong phi√™n b·∫£n ·ªïn ƒë·ªãnh c·ªßa React.

</Wip>

S·ª≠ d·ª•ng m·ªôt Hook ƒë·∫∑c bi·ªát g·ªçi l√† [`useEffectEvent`](/reference/react/experimental_useEffectEvent) ƒë·ªÉ t√°ch logic kh√¥ng reactive n√†y ra kh·ªèi Effect:

```js {1,4-6}
import { useEffect, useEffectEvent } from 'react';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });
  // ...
```

·ªû ƒë√¢y, `onConnected` ƒë∆∞·ª£c g·ªçi l√† *Effect Event*. N√≥ l√† m·ªôt ph·∫ßn c·ªßa logic Effect, nh∆∞ng n√≥ ho·∫°t ƒë·ªông gi·ªëng nh∆∞ m·ªôt event handler h∆°n. Logic b√™n trong n√≥ kh√¥ng ph·∫£i l√† reactive, v√† n√≥ lu√¥n "th·∫•y" gi√° tr·ªã m·ªõi nh·∫•t c·ªßa props v√† state.

B√¢y gi·ªù b·∫°n c√≥ th·ªÉ g·ªçi Effect Event `onConnected` t·ª´ b√™n trong Effect:

```js {2-4,9,13}
function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]); // ‚úÖ All dependencies declared
  // ...
```

ƒêi·ªÅu n√†y gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ. L∆∞u √Ω r·∫±ng b·∫°n ph·∫£i *x√≥a* `theme` kh·ªèi danh s√°ch dependency c·ªßa Effect, v√¨ n√≥ kh√¥ng c√≤n ƒë∆∞·ª£c s·ª≠ d·ª•ng trong Effect n·ªØa. B·∫°n c≈©ng kh√¥ng c·∫ßn *th√™m* `onConnected` v√†o ƒë√≥, v√¨ **Effect Event kh√¥ng ph·∫£i l√† reactive v√† ph·∫£i ƒë∆∞·ª£c b·ªè qua kh·ªèi dependency.**

X√°c minh r·∫±ng h√†nh vi m·ªõi ho·∫°t ƒë·ªông nh∆∞ b·∫°n mong ƒë·ª£i:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Connected!', theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      onConnected();
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}
```

```js src/notifications.js hidden
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label { display: block; margin-top: 10px; }
```

</Sandpack>

B·∫°n c√≥ th·ªÉ nghƒ© v·ªÅ Effect Event nh∆∞ r·∫•t gi·ªëng v·ªõi event handler. S·ª± kh√°c bi·ªát ch√≠nh l√† event handler ch·∫°y ƒë·ªÉ ph·∫£n h·ªìi t∆∞∆°ng t√°c c·ªßa ng∆∞·ªùi d√πng, trong khi Effect Event ƒë∆∞·ª£c k√≠ch ho·∫°t b·ªüi b·∫°n t·ª´ Effect. Effect Event cho ph√©p b·∫°n "ph√° v·ª° chu·ªói" gi·ªØa t√≠nh reactive c·ªßa Effect v√† code kh√¥ng n√™n l√† reactive.

### ƒê·ªçc props v√† state m·ªõi nh·∫•t b·∫±ng Effect Event {/*reading-latest-props-and-state-with-effect-events*/}

<Wip>

Ph·∫ßn n√†y m√¥ t·∫£ m·ªôt **API th·ª≠ nghi·ªám ch∆∞a ƒë∆∞·ª£c ph√°t h√†nh** trong phi√™n b·∫£n ·ªïn ƒë·ªãnh c·ªßa React.

</Wip>

Effect Event cho ph√©p b·∫°n s·ª≠a nhi·ªÅu pattern m√† b·∫°n c√≥ th·ªÉ mu·ªën b·ªè qua dependency linter.

V√≠ d·ª•, gi·∫£ s·ª≠ b·∫°n c√≥ m·ªôt Effect ƒë·ªÉ ghi l·∫°i l∆∞·ª£t truy c·∫≠p trang:

```js
function Page() {
  useEffect(() => {
    logVisit();
  }, []);
  // ...
}
```

Sau ƒë√≥, b·∫°n th√™m nhi·ªÅu route v√†o trang web. B√¢y gi·ªù component `Page` nh·∫≠n m·ªôt prop `url` v·ªõi ƒë∆∞·ªùng d·∫´n hi·ªán t·∫°i. B·∫°n mu·ªën truy·ªÅn `url` nh∆∞ m·ªôt ph·∫ßn c·ªßa l·ªùi g·ªçi `logVisit`, nh∆∞ng dependency linter ph√†n n√†n:

```js {1,3}
function Page({ url }) {
  useEffect(() => {
    logVisit(url);
  }, []); // üî¥ React Hook useEffect has a missing dependency: 'url'
  // ...
}
```

H√£y suy nghƒ© v·ªÅ nh·ªØng g√¨ b·∫°n mu·ªën code l√†m. B·∫°n *mu·ªën* ghi nh·∫≠t k√Ω m·ªôt l·∫ßn truy c·∫≠p ri√™ng bi·ªát cho c√°c URL kh√°c nhau v√¨ m·ªói URL ƒë·∫°i di·ªán cho m·ªôt trang kh√°c nhau. N√≥i c√°ch kh√°c, l·ªùi g·ªçi `logVisit` n√†y *n√™n* l√† reactive ƒë·ªëi v·ªõi `url`. ƒê√≥ l√† l√Ω do trong tr∆∞·ªùng h·ª£p n√†y, vi·ªác tu√¢n theo dependency linter v√† th√™m `url` l√†m dependency l√† h·ª£p l√Ω:

```js {4}
function Page({ url }) {
  useEffect(() => {
    logVisit(url);
  }, [url]); // ‚úÖ All dependencies declared
  // ...
}
```

B√¢y gi·ªù gi·∫£ s·ª≠ b·∫°n mu·ªën bao g·ªìm s·ªë l∆∞·ª£ng m·∫∑t h√†ng trong gi·ªè h√†ng c√πng v·ªõi m·ªói l·∫ßn truy c·∫≠p trang:

```js {2-3,6}
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  useEffect(() => {
    logVisit(url, numberOfItems);
  }, [url]); // üî¥ React Hook useEffect has a missing dependency: 'numberOfItems'
  // ...
}
```

B·∫°n ƒë√£ s·ª≠ d·ª•ng `numberOfItems` b√™n trong Effect, n√™n linter y√™u c·∫ßu b·∫°n th√™m n√≥ l√†m dependency. Tuy nhi√™n, b·∫°n *kh√¥ng* mu·ªën l·ªùi g·ªçi `logVisit` l√† reactive ƒë·ªëi v·ªõi `numberOfItems`. N·∫øu ng∆∞·ªùi d√πng ƒë∆∞a th·ª© g√¨ ƒë√≥ v√†o gi·ªè h√†ng v√† `numberOfItems` thay ƒë·ªïi, ƒëi·ªÅu n√†y *kh√¥ng c√≥ nghƒ©a* l√† ng∆∞·ªùi d√πng ƒë√£ truy c·∫≠p trang l·∫°i. N√≥i c√°ch kh√°c, *vi·ªác truy c·∫≠p trang* theo m·ªôt nghƒ©a n√†o ƒë√≥ l√† m·ªôt "s·ª± ki·ªán". N√≥ x·∫£y ra t·∫°i m·ªôt th·ªùi ƒëi·ªÉm ch√≠nh x√°c.

Chia code th√†nh hai ph·∫ßn:

```js {5-7,10}
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  const onVisit = useEffectEvent(visitedUrl => {
    logVisit(visitedUrl, numberOfItems);
  });

  useEffect(() => {
    onVisit(url);
  }, [url]); // ‚úÖ All dependencies declared
  // ...
}
```

·ªû ƒë√¢y, `onVisit` l√† m·ªôt Effect Event. Code b√™n trong n√≥ kh√¥ng ph·∫£i l√† reactive. ƒê√≥ l√† l√Ω do b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng `numberOfItems` (ho·∫∑c b·∫•t k·ª≥ gi√° tr·ªã reactive n√†o kh√°c!) m√† kh√¥ng lo l·∫Øng r·∫±ng n√≥ s·∫Ω khi·∫øn code xung quanh ch·∫°y l·∫°i khi c√≥ thay ƒë·ªïi.

M·∫∑t kh√°c, b·∫£n th√¢n Effect v·∫´n l√† reactive. Code b√™n trong Effect s·ª≠ d·ª•ng prop `url`, n√™n Effect s·∫Ω ch·∫°y l·∫°i sau m·ªói l·∫ßn render l·∫°i v·ªõi `url` kh√°c nhau. ƒêi·ªÅu n√†y, ƒë·∫øn l∆∞·ª£t n√≥, s·∫Ω g·ªçi Effect Event `onVisit`.

K·∫øt qu·∫£ l√†, b·∫°n s·∫Ω g·ªçi `logVisit` cho m·ªói thay ƒë·ªïi c·ªßa `url`, v√† lu√¥n ƒë·ªçc `numberOfItems` m·ªõi nh·∫•t. Tuy nhi√™n, n·∫øu `numberOfItems` thay ƒë·ªïi m·ªôt m√¨nh, ƒëi·ªÅu n√†y s·∫Ω kh√¥ng khi·∫øn b·∫•t k·ª≥ code n√†o ch·∫°y l·∫°i.

<Note>

B·∫°n c√≥ th·ªÉ th·∫Øc m·∫Øc li·ªáu c√≥ th·ªÉ g·ªçi `onVisit()` kh√¥ng c√≥ tham s·ªë v√† ƒë·ªçc `url` b√™n trong n√≥ kh√¥ng:

```js {2,6}
  const onVisit = useEffectEvent(() => {
    logVisit(url, numberOfItems);
  });

  useEffect(() => {
    onVisit();
  }, [url]);
```

ƒêi·ªÅu n√†y s·∫Ω ho·∫°t ƒë·ªông, nh∆∞ng t·ªët h∆°n l√† truy·ªÅn `url` n√†y cho Effect Event m·ªôt c√°ch r√µ r√†ng. **B·∫±ng c√°ch truy·ªÅn `url` l√†m tham s·ªë cho Effect Event, b·∫°n ƒëang n√≥i r·∫±ng vi·ªác truy c·∫≠p m·ªôt trang v·ªõi `url` kh√°c nhau t·∫°o th√†nh m·ªôt "s·ª± ki·ªán" ri√™ng bi·ªát t·ª´ g√≥c nh√¨n c·ªßa ng∆∞·ªùi d√πng.** `visitedUrl` l√† m·ªôt *ph·∫ßn* c·ªßa "s·ª± ki·ªán" ƒë√£ x·∫£y ra:

```js {1-2,6}
  const onVisit = useEffectEvent(visitedUrl => {
    logVisit(visitedUrl, numberOfItems);
  });

  useEffect(() => {
    onVisit(url);
  }, [url]);
```

V√¨ Effect Event c·ªßa b·∫°n r√µ r√†ng "y√™u c·∫ßu" `visitedUrl`, b√¢y gi·ªù b·∫°n kh√¥ng th·ªÉ v√¥ t√¨nh x√≥a `url` kh·ªèi dependency c·ªßa Effect. N·∫øu b·∫°n x√≥a dependency `url` (khi·∫øn c√°c l·∫ßn truy c·∫≠p trang kh√°c nhau ƒë∆∞·ª£c t√≠nh l√† m·ªôt), linter s·∫Ω c·∫£nh b√°o b·∫°n v·ªÅ ƒëi·ªÅu ƒë√≥. B·∫°n mu·ªën `onVisit` l√† reactive ƒë·ªëi v·ªõi `url`, n√™n thay v√¨ ƒë·ªçc `url` b√™n trong (n∆°i n√≥ s·∫Ω kh√¥ng reactive), b·∫°n truy·ªÅn n√≥ *t·ª´* Effect c·ªßa m√¨nh.

ƒêi·ªÅu n√†y tr·ªü n√™n ƒë·∫∑c bi·ªát quan tr·ªçng n·∫øu c√≥ logic b·∫•t ƒë·ªìng b·ªô b√™n trong Effect:

```js {6,8}
  const onVisit = useEffectEvent(visitedUrl => {
    logVisit(visitedUrl, numberOfItems);
  });

  useEffect(() => {
    setTimeout(() => {
      onVisit(url);
    }, 5000); // Delay logging visits
  }, [url]);
```

·ªû ƒë√¢y, `url` b√™n trong `onVisit` t∆∞∆°ng ·ª©ng v·ªõi `url` *m·ªõi nh·∫•t* (c√≥ th·ªÉ ƒë√£ thay ƒë·ªïi), nh∆∞ng `visitedUrl` t∆∞∆°ng ·ª©ng v·ªõi `url` ban ƒë·∫ßu ƒë√£ khi·∫øn Effect n√†y (v√† l·ªùi g·ªçi `onVisit` n√†y) ch·∫°y.

</Note>

<DeepDive>

#### C√≥ ƒë∆∞·ª£c ph√©p b·ªè qua dependency linter thay th·∫ø kh√¥ng? {/*is-it-okay-to-suppress-the-dependency-linter-instead*/}

Trong c√°c codebase hi·ªán c√≥, ƒë√¥i khi b·∫°n c√≥ th·ªÉ th·∫•y quy t·∫Øc lint b·ªã b·ªè qua nh∆∞ th·∫ø n√†y:

```js {7-9}
function Page({ url }) {
  const { items } = useContext(ShoppingCartContext);
  const numberOfItems = items.length;

  useEffect(() => {
    logVisit(url, numberOfItems);
    // üî¥ Avoid suppressing the linter like this:
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, [url]);
  // ...
}
```

Sau khi `useEffectEvent` tr·ªü th√†nh m·ªôt ph·∫ßn ·ªïn ƒë·ªãnh c·ªßa React, ch√∫ng t√¥i khuy·∫øn ngh·ªã **kh√¥ng bao gi·ªù b·ªè qua linter**.

Nh∆∞·ª£c ƒëi·ªÉm ƒë·∫ßu ti√™n c·ªßa vi·ªác b·ªè qua quy t·∫Øc l√† React s·∫Ω kh√¥ng c√≤n c·∫£nh b√°o b·∫°n khi Effect c·ªßa b·∫°n c·∫ßn "ph·∫£n ·ª©ng" v·ªõi m·ªôt dependency reactive m·ªõi m√† b·∫°n ƒë√£ th√™m v√†o code. Trong v√≠ d·ª• tr∆∞·ªõc, b·∫°n ƒë√£ th√™m `url` v√†o dependency *b·ªüi v√¨* React nh·∫Øc nh·ªü b·∫°n l√†m ƒëi·ªÅu ƒë√≥. B·∫°n s·∫Ω kh√¥ng c√≤n nh·∫≠n ƒë∆∞·ª£c nh·ªØng l·ªùi nh·∫Øc nh·ªü nh∆∞ v·∫≠y cho b·∫•t k·ª≥ ch·ªânh s·ª≠a n√†o trong t∆∞∆°ng lai c·ªßa Effect ƒë√≥ n·∫øu b·∫°n v√¥ hi·ªáu h√≥a linter. ƒêi·ªÅu n√†y d·∫´n ƒë·∫øn bugs.

ƒê√¢y l√† m·ªôt v√≠ d·ª• v·ªÅ m·ªôt bug kh√≥ hi·ªÉu do vi·ªác b·ªè qua linter. Trong v√≠ d·ª• n√†y, function `handleMove` ƒë∆∞·ª£c cho l√† s·∫Ω ƒë·ªçc gi√° tr·ªã bi·∫øn state `canMove` hi·ªán t·∫°i ƒë·ªÉ quy·∫øt ƒë·ªãnh xem d·∫•u ch·∫•m c√≥ n√™n theo con tr·ªè hay kh√¥ng. Tuy nhi√™n, `canMove` lu√¥n l√† `true` b√™n trong `handleMove`.

B·∫°n c√≥ th·ªÉ th·∫•y t·∫°i sao kh√¥ng?

<Sandpack>

```js
import { useState, useEffect } from 'react';

export default function App() {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [canMove, setCanMove] = useState(true);

  function handleMove(e) {
    if (canMove) {
      setPosition({ x: e.clientX, y: e.clientY });
    }
  }

  useEffect(() => {
    window.addEventListener('pointermove', handleMove);
    return () => window.removeEventListener('pointermove', handleMove);
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return (
    <>
      <label>
        <input type="checkbox"
          checked={canMove}
          onChange={e => setCanMove(e.target.checked)}
        />
        The dot is allowed to move
      </label>
      <hr />
      <div style={{
        position: 'absolute',
        backgroundColor: 'pink',
        borderRadius: '50%',
        opacity: 0.6,
        transform: `translate(${position.x}px, ${position.y}px)`,
        pointerEvents: 'none',
        left: -20,
        top: -20,
        width: 40,
        height: 40,
      }} />
    </>
  );
}
```

```css
body {
  height: 200px;
}
```

</Sandpack>


V·∫•n ƒë·ªÅ v·ªõi code n√†y n·∫±m ·ªü vi·ªác b·ªè qua dependency linter. N·∫øu b·∫°n x√≥a comment b·ªè qua, b·∫°n s·∫Ω th·∫•y r·∫±ng Effect n√†y n√™n ph·ª• thu·ªôc v√†o function `handleMove`. ƒêi·ªÅu n√†y h·ª£p l√Ω: `handleMove` ƒë∆∞·ª£c khai b√°o b√™n trong th√¢n component, ƒëi·ªÅu n√†y khi·∫øn n√≥ tr·ªü th√†nh m·ªôt gi√° tr·ªã reactive. M·ªçi gi√° tr·ªã reactive ph·∫£i ƒë∆∞·ª£c khai b√°o l√†m dependency, ho·∫∑c n√≥ c√≥ th·ªÉ tr·ªü n√™n c≈© theo th·ªùi gian!

T√°c gi·∫£ c·ªßa code g·ªëc ƒë√£ "n√≥i d·ªëi" React b·∫±ng c√°ch n√≥i r·∫±ng Effect kh√¥ng ph·ª• thu·ªôc (`[]`) v√†o b·∫•t k·ª≥ gi√° tr·ªã reactive n√†o. ƒê√≥ l√† l√Ω do t·∫°i sao React kh√¥ng ƒë·ªìng b·ªô l·∫°i Effect sau khi `canMove` thay ƒë·ªïi (v√† `handleMove` c√πng v·ªõi n√≥). B·ªüi v√¨ React kh√¥ng ƒë·ªìng b·ªô l·∫°i Effect, `handleMove` ƒë∆∞·ª£c g·∫Øn l√†m listener l√† function `handleMove` ƒë∆∞·ª£c t·∫°o trong l·∫ßn render ƒë·∫ßu ti√™n. Trong l·∫ßn render ƒë·∫ßu ti√™n, `canMove` l√† `true`, ƒë√≥ l√† l√Ω do t·∫°i sao `handleMove` t·ª´ l·∫ßn render ƒë·∫ßu ti√™n s·∫Ω m√£i m√£i th·∫•y gi√° tr·ªã ƒë√≥.

**N·∫øu b·∫°n kh√¥ng bao gi·ªù b·ªè qua linter, b·∫°n s·∫Ω kh√¥ng bao gi·ªù g·∫∑p v·∫•n ƒë·ªÅ v·ªõi gi√° tr·ªã c≈©.**

V·ªõi `useEffectEvent`, kh√¥ng c·∫ßn "n√≥i d·ªëi" linter, v√† code ho·∫°t ƒë·ªông nh∆∞ b·∫°n mong ƒë·ª£i:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function App() {
  const [position, setPosition] = useState({ x: 0, y: 0 });
  const [canMove, setCanMove] = useState(true);

  const onMove = useEffectEvent(e => {
    if (canMove) {
      setPosition({ x: e.clientX, y: e.clientY });
    }
  });

  useEffect(() => {
    window.addEventListener('pointermove', onMove);
    return () => window.removeEventListener('pointermove', onMove);
  }, []);

  return (
    <>
      <label>
        <input type="checkbox"
          checked={canMove}
          onChange={e => setCanMove(e.target.checked)}
        />
        The dot is allowed to move
      </label>
      <hr />
      <div style={{
        position: 'absolute',
        backgroundColor: 'pink',
        borderRadius: '50%',
        opacity: 0.6,
        transform: `translate(${position.x}px, ${position.y}px)`,
        pointerEvents: 'none',
        left: -20,
        top: -20,
        width: 40,
        height: 40,
      }} />
    </>
  );
}
```

```css
body {
  height: 200px;
}
```

</Sandpack>

ƒêi·ªÅu n√†y kh√¥ng c√≥ nghƒ©a l√† `useEffectEvent` *lu√¥n* l√† gi·∫£i ph√°p ƒë√∫ng. B·∫°n ch·ªâ n√™n √°p d·ª•ng n√≥ cho nh·ªØng d√≤ng code m√† b·∫°n kh√¥ng mu·ªën l√† reactive. Trong sandbox ·ªü tr√™n, b·∫°n kh√¥ng mu·ªën code c·ªßa Effect l√† reactive ƒë·ªëi v·ªõi `canMove`. ƒê√≥ l√† l√Ω do vi·ªác t√°ch ra m·ªôt Effect Event c√≥ √Ω nghƒ©a.

ƒê·ªçc [Removing Effect Dependencies](/learn/removing-effect-dependencies) ƒë·ªÉ bi·∫øt c√°c l·ª±a ch·ªçn kh√°c ƒë√∫ng ƒë·∫Øn thay cho vi·ªác b·ªè qua linter.

</DeepDive>

### Gi·ªõi h·∫°n c·ªßa Effect Event {/*limitations-of-effect-events*/}

<Wip>

Ph·∫ßn n√†y m√¥ t·∫£ m·ªôt **API th·ª≠ nghi·ªám ch∆∞a ƒë∆∞·ª£c ph√°t h√†nh** trong phi√™n b·∫£n ·ªïn ƒë·ªãnh c·ªßa React.

</Wip>

Effect Event r·∫•t h·∫°n ch·∫ø trong c√°ch b·∫°n c√≥ th·ªÉ s·ª≠ d·ª•ng ch√∫ng:

- **Ch·ªâ g·ªçi ch√∫ng t·ª´ b√™n trong Effect.**
- **Kh√¥ng bao gi·ªù truy·ªÅn ch√∫ng cho component ho·∫∑c Hook kh√°c.**

V√≠ d·ª•, ƒë·ª´ng khai b√°o v√† truy·ªÅn Effect Event nh∆∞ th·∫ø n√†y:

```js {4-6,8}
function Timer() {
  const [count, setCount] = useState(0);

  const onTick = useEffectEvent(() => {
    setCount(count + 1);
  });

  useTimer(onTick, 1000); // üî¥ Avoid: Passing Effect Events

  return <h1>{count}</h1>
}

function useTimer(callback, delay) {
  useEffect(() => {
    const id = setInterval(() => {
      callback();
    }, delay);
    return () => {
      clearInterval(id);
    };
  }, [delay, callback]); // Need to specify "callback" in dependencies
}
```

Thay v√†o ƒë√≥, lu√¥n khai b√°o Effect Event tr·ª±c ti·∫øp b√™n c·∫°nh Effect s·ª≠ d·ª•ng ch√∫ng:

```js {10-12,16,21}
function Timer() {
  const [count, setCount] = useState(0);
  useTimer(() => {
    setCount(count + 1);
  }, 1000);
  return <h1>{count}</h1>
}

function useTimer(callback, delay) {
  const onTick = useEffectEvent(() => {
    callback();
  });

  useEffect(() => {
    const id = setInterval(() => {
      onTick(); // ‚úÖ Good: Only called locally inside an Effect
    }, delay);
    return () => {
      clearInterval(id);
    };
  }, [delay]); // No need to specify "onTick" (an Effect Event) as a dependency
}
```

Effect Event l√† nh·ªØng "m·∫£nh" kh√¥ng reactive c·ªßa code Effect. Ch√∫ng n√™n ƒë∆∞·ª£c ƒë·∫∑t g·∫ßn Effect s·ª≠ d·ª•ng ch√∫ng.

<Recap>

- Event handler ch·∫°y ƒë·ªÉ ph·∫£n h·ªìi c√°c t∆∞∆°ng t√°c c·ª• th·ªÉ.
- Effect ch·∫°y b·∫•t c·ª© khi n√†o c·∫ßn ƒë·ªìng b·ªô h√≥a.
- Logic b√™n trong event handler kh√¥ng ph·∫£i l√† reactive.
- Logic b√™n trong Effect l√† reactive.
- B·∫°n c√≥ th·ªÉ chuy·ªÉn logic kh√¥ng reactive t·ª´ Effect v√†o Effect Event.
- Ch·ªâ g·ªçi Effect Event t·ª´ b√™n trong Effect.
- Kh√¥ng truy·ªÅn Effect Event cho component ho·∫∑c Hook kh√°c.

</Recap>

<Challenges>

#### S·ª≠a bi·∫øn kh√¥ng c·∫≠p nh·∫≠t {/*fix-a-variable-that-doesnt-update*/}

Component `Timer` n√†y gi·ªØ m·ªôt bi·∫øn state `count` tƒÉng l√™n m·ªói gi√¢y. Gi√° tr·ªã m√† n√≥ tƒÉng l√™n ƒë∆∞·ª£c l∆∞u trong bi·∫øn state `increment`. B·∫°n c√≥ th·ªÉ ƒëi·ªÅu khi·ªÉn bi·∫øn `increment` b·∫±ng c√°c n√∫t c·ªông v√† tr·ª´.

Tuy nhi√™n, d√π b·∫°n nh·∫•n n√∫t c·ªông bao nhi√™u l·∫ßn, b·ªô ƒë·∫øm v·∫´n ch·ªâ tƒÉng l√™n m·ªôt m·ªói gi√¢y. C√≥ g√¨ sai v·ªõi code n√†y? V√¨ sao `increment` lu√¥n b·∫±ng `1` b√™n trong code Effect? T√¨m l·ªói v√† s·ª≠a n√≥.

<Hint>

ƒê·ªÉ s·ª≠a code n√†y, ch·ªâ c·∫ßn tu√¢n theo c√°c quy t·∫Øc.

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```


```js
import { useState, useEffect } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(c => c + increment);
    }, 1000);
    return () => {
      clearInterval(id);
    };
    // eslint-disable-next-line react-hooks/exhaustive-deps
  }, []);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Every second, increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
    </>
  );
}
```

```css
button { margin: 10px; }
```

</Sandpack>

<Solution>

Nh∆∞ th∆∞·ªùng l·ªá, khi b·∫°n t√¨m ki·∫øm bugs trong Effect, h√£y b·∫Øt ƒë·∫ßu b·∫±ng c√°ch t√≠m ki·∫øm nh·ªØng ch·ªó b·ªè qua linter.

N·∫øu b·∫°n x√≥a comment b·ªè qua, React s·∫Ω cho b·∫°n bi·∫øt r·∫±ng code c·ªßa Effect n√†y ph·ª• thu·ªôc v√†o `increment`, nh∆∞ng b·∫°n ƒë√£ "n√≥i d·ªëi" React b·∫±ng c√°ch kh·∫≥ng ƒë·ªãnh r·∫±ng Effect n√†y kh√¥ng ph·ª• thu·ªôc v√†o b·∫•t k·ª≥ gi√° tr·ªã reactive n√†o (`[]`). Th√™m `increment` v√†o m·∫£ng dependency:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(c => c + increment);
    }, 1000);
    return () => {
      clearInterval(id);
    };
  }, [increment]);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Every second, increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
    </>
  );
}
```

```css
button { margin: 10px; }
```

</Sandpack>

B√¢y gi·ªù, khi `increment` thay ƒë·ªïi, React s·∫Ω ƒë·ªìng b·ªô l·∫°i Effect c·ªßa b·∫°n, ƒëi·ªÅu n√†y s·∫Ω kh·ªüi ƒë·ªông l·∫°i interval.

</Solution>

#### S·ª≠a b·ªô ƒë·∫øm b·ªã ƒë√≥ng bƒÉng {/*fix-a-freezing-counter*/}

Component `Timer` n√†y gi·ªØ m·ªôt bi·∫øn state `count` tƒÉng l√™n m·ªói gi√¢y. Gi√° tr·ªã m√† n√≥ tƒÉng l√™n ƒë∆∞·ª£c l∆∞u trong bi·∫øn state `increment`, b·∫°n c√≥ th·ªÉ ƒëi·ªÅu khi·ªÉn n√≥ b·∫±ng c√°c n√∫t c·ªông v√† tr·ª´. V√≠ d·ª•, h√£y th·ª≠ nh·∫•n n√∫t c·ªông ch√≠n l·∫ßn v√† ƒë·ªÉ √Ω r·∫±ng `count` gi·ªù ƒë√¢y tƒÉng m·ªói gi√¢y l√† m∆∞·ªùi thay v√¨ m·ªôt.

C√≥ m·ªôt v·∫•n ƒë·ªÅ nh·ªè v·ªõi giao di·ªán ng∆∞·ªùi d√πng n√†y. B·∫°n c√≥ th·ªÉ ƒë·ªÉ √Ω r·∫±ng n·∫øu b·∫°n li√™n t·ª•c nh·∫•n n√∫t c·ªông ho·∫∑c tr·ª´ nhanh h∆°n m·ªôt l·∫ßn m·ªói gi√¢y, b·∫£n th√¢n timer d∆∞·ªùng nh∆∞ b·ªã t·∫°m d·ª´ng. N√≥ ch·ªâ ti·∫øp t·ª•c sau khi m·ªôt gi√¢y tr√¥i qua k·ªÉ t·ª´ l·∫ßn cu·ªëi b·∫°n nh·∫•n m·ªôt trong hai n√∫t. T√¨m hi·ªÉu t·∫°i sao ƒëi·ªÅu n√†y x·∫£y ra v√† s·ª≠a v·∫•n ƒë·ªÅ ƒë·ªÉ timer tick tr√™n *m·ªói* gi√¢y kh√¥ng b·ªã gi√°n ƒëo·∫°n.

<Hint>

C√≥ v·∫ª nh∆∞ Effect thi·∫øt l·∫≠p timer "ph·∫£n ·ª©ng" v·ªõi gi√° tr·ªã `increment`. D√≤ng s·ª≠ d·ª•ng gi√° tr·ªã `increment` hi·ªán t·∫°i ƒë·ªÉ g·ªçi `setCount` c√≥ th·ª±c s·ª± c·∫ßn l√† reactive kh√¥ng?

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  useEffect(() => {
    const id = setInterval(() => {
      setCount(c => c + increment);
    }, 1000);
    return () => {
      clearInterval(id);
    };
  }, [increment]);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Every second, increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
    </>
  );
}
```

```css
button { margin: 10px; }
```

</Sandpack>

<Solution>

V·∫•n ƒë·ªÅ l√† code b√™n trong Effect s·ª≠ d·ª•ng bi·∫øn state `increment`. V√¨ n√≥ l√† dependency c·ªßa Effect, m·ªói thay ƒë·ªïi ƒë·ªëi v·ªõi `increment` khi·∫øn Effect ƒë·ªìng b·ªô l·∫°i, ƒëi·ªÅu n√†y khi·∫øn interval b·ªã x√≥a. N·∫øu b·∫°n li√™n t·ª•c x√≥a interval m·ªói l·∫ßn tr∆∞·ªõc khi n√≥ c√≥ c∆° h·ªôi k√≠ch ho·∫°t, n√≥ s·∫Ω xu·∫•t hi·ªán nh∆∞ th·ªÉ timer ƒë√£ b·ªã d·ª´ng.

ƒê·ªÉ gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ, h√£y t√°ch m·ªôt Effect Event `onTick` ra kh·ªèi Effect:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);

  const onTick = useEffectEvent(() => {
    setCount(c => c + increment);
  });

  useEffect(() => {
    const id = setInterval(() => {
      onTick();
    }, 1000);
    return () => {
      clearInterval(id);
    };
  }, []);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Every second, increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
    </>
  );
}
```


```css
button { margin: 10px; }
```

</Sandpack>

V√¨ `onTick` l√† m·ªôt Effect Event, code b√™n trong n√≥ kh√¥ng ph·∫£i l√† reactive. Thay ƒë·ªïi ƒë·ªëi v·ªõi `increment` kh√¥ng k√≠ch ho·∫°t b·∫•t k·ª≥ Effect n√†o.

</Solution>

#### S·ª≠a delay kh√¥ng th·ªÉ ƒëi·ªÅu ch·ªânh {/*fix-a-non-adjustable-delay*/}

Trong v√≠ d·ª• n√†y, b·∫°n c√≥ th·ªÉ t√πy ch·ªânh delay c·ªßa interval. N√≥ ƒë∆∞·ª£c l∆∞u trong bi·∫øn state `delay` ƒë∆∞·ª£c c·∫≠p nh·∫≠t b·ªüi hai n√∫t. Tuy nhi√™n, ngay c·∫£ khi b·∫°n nh·∫•n n√∫t "plus 100 ms" cho ƒë·∫øn khi `delay` l√† 1000 milliseconds (t·ª©c l√† m·ªôt gi√¢y), b·∫°n s·∫Ω ƒë·ªÉ √Ω r·∫±ng timer v·∫´n tƒÉng r·∫•t nhanh (m·ªói 100 ms). Nh∆∞ th·ªÉ nh·ªØng thay ƒë·ªïi c·ªßa b·∫°n ƒë·ªëi v·ªõi `delay` b·ªã b·ªè qua. T√¨m v√† s·ª≠a bug.

<Hint>

Code b√™n trong Effect Event kh√¥ng ph·∫£i l√† reactive. C√≥ tr∆∞·ªùng h·ª£p n√†o m√† b·∫°n *mu·ªën* l·ªùi g·ªçi `setInterval` ch·∫°y l·∫°i kh√¥ng?

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);
  const [delay, setDelay] = useState(100);

  const onTick = useEffectEvent(() => {
    setCount(c => c + increment);
  });

  const onMount = useEffectEvent(() => {
    return setInterval(() => {
      onTick();
    }, delay);
  });

  useEffect(() => {
    const id = onMount();
    return () => {
      clearInterval(id);
    }
  }, []);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
      <p>
        Increment delay:
        <button disabled={delay === 100} onClick={() => {
          setDelay(d => d - 100);
        }}>‚Äì100 ms</button>
        <b>{delay} ms</b>
        <button onClick={() => {
          setDelay(d => d + 100);
        }}>+100 ms</button>
      </p>
    </>
  );
}
```


```css
button { margin: 10px; }
```

</Sandpack>

<Solution>

V·∫•n ƒë·ªÅ v·ªõi v√≠ d·ª• tr√™n l√† n√≥ ƒë√£ t√°ch m·ªôt Effect Event g·ªçi l√† `onMount` m√† kh√¥ng xem x√©t code th·ª±c s·ª± n√™n l√†m g√¨. B·∫°n ch·ªâ n√™n t√°ch Effect Event v√¨ m·ªôt l√Ω do c·ª• th·ªÉ: khi b·∫°n mu·ªën l√†m cho m·ªôt ph·∫ßn code kh√¥ng reactive. Tuy nhi√™n, l·ªùi g·ªçi `setInterval` *n√™n* l√† reactive ƒë·ªëi v·ªõi bi·∫øn state `delay`. N·∫øu `delay` thay ƒë·ªïi, b·∫°n mu·ªën thi·∫øt l·∫≠p interval t·ª´ ƒë·∫ßu! ƒê·ªÉ s·ª≠a code n√†y, k√©o t·∫•t c·∫£ code reactive tr·ªü l·∫°i b√™n trong Effect:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';

export default function Timer() {
  const [count, setCount] = useState(0);
  const [increment, setIncrement] = useState(1);
  const [delay, setDelay] = useState(100);

  const onTick = useEffectEvent(() => {
    setCount(c => c + increment);
  });

  useEffect(() => {
    const id = setInterval(() => {
      onTick();
    }, delay);
    return () => {
      clearInterval(id);
    }
  }, [delay]);

  return (
    <>
      <h1>
        Counter: {count}
        <button onClick={() => setCount(0)}>Reset</button>
      </h1>
      <hr />
      <p>
        Increment by:
        <button disabled={increment === 0} onClick={() => {
          setIncrement(i => i - 1);
        }}>‚Äì</button>
        <b>{increment}</b>
        <button onClick={() => {
          setIncrement(i => i + 1);
        }}>+</button>
      </p>
      <p>
        Increment delay:
        <button disabled={delay === 100} onClick={() => {
          setDelay(d => d - 100);
        }}>‚Äì100 ms</button>
        <b>{delay} ms</b>
        <button onClick={() => {
          setDelay(d => d + 100);
        }}>+100 ms</button>
      </p>
    </>
  );
}
```

```css
button { margin: 10px; }
```

</Sandpack>

N√≥i chung, b·∫°n n√™n nghi ng·ªù c√°c function nh∆∞ `onMount` t·∫≠p trung v√†o *th·ªùi ƒëi·ªÉm* thay v√¨ *m·ª•c ƒë√≠ch* c·ªßa m·ªôt ƒëo·∫°n code. L√∫c ƒë·∫ßu n√≥ c√≥ th·ªÉ c·∫£m th·∫•y "m√¥ t·∫£ h∆°n" nh∆∞ng n√≥ che khu·∫•t √Ω ƒë·ªãnh c·ªßa b·∫°n. Theo quy t·∫Øc chung, Effect Event n√™n t∆∞∆°ng ·ª©ng v·ªõi ƒëi·ªÅu g√¨ ƒë√≥ x·∫£y ra t·ª´ g√≥c nh√¨n c·ªßa *ng∆∞·ªùi d√πng*. V√≠ d·ª•, `onMessage`, `onTick`, `onVisit`, ho·∫∑c `onConnected` l√† nh·ªØng t√™n Effect Event t·ªët. Code b√™n trong ch√∫ng c√≥ th·ªÉ s·∫Ω kh√¥ng c·∫ßn l√† reactive. M·∫∑t kh√°c, `onMount`, `onUpdate`, `onUnmount`, ho·∫∑c `onAfterRender` qu√° chung chung ƒë·∫øn m·ª©c d·ªÖ v√¥ t√¨nh ƒë·∫∑t code *n√™n* l√† reactive v√†o trong ch√∫ng. ƒê√≥ l√† l√Ω do b·∫°n n√™n ƒë·∫∑t t√™n Effect Event theo *ƒëi·ªÅu ng∆∞·ªùi d√πng nghƒ© ƒë√£ x·∫£y ra*, kh√¥ng ph·∫£i khi n√†o code ƒë∆∞·ª£c ch·∫°y.

</Solution>

#### S·ª≠a th√¥ng b√°o b·ªã tr√¨ ho√£n {/*fix-a-delayed-notification*/}

Khi b·∫°n tham gia m·ªôt ph√≤ng chat, component n√†y hi·ªÉn th·ªã th√¥ng b√°o. Tuy nhi√™n, n√≥ kh√¥ng hi·ªÉn th·ªã th√¥ng b√°o ngay l·∫≠p t·ª©c. Thay v√†o ƒë√≥, th√¥ng b√°o ƒë∆∞·ª£c tr√¨ ho√£n nh√¢n t·∫°o hai gi√¢y ƒë·ªÉ ng∆∞·ªùi d√πng c√≥ c∆° h·ªôi nh√¨n xung quanh UI.

ƒêi·ªÅu n√†y g·∫ßn nh∆∞ ho·∫°t ƒë·ªông, nh∆∞ng c√≥ m·ªôt bug. H√£y th·ª≠ ƒë·ªïi dropdown t·ª´ "general" sang "travel" r·ªìi sang "music" r·∫•t nhanh. N·∫øu b·∫°n l√†m ƒë·ªß nhanh, b·∫°n s·∫Ω th·∫•y hai th√¥ng b√°o (nh∆∞ mong ƒë·ª£i!) nh∆∞ng ch√∫ng s·∫Ω *ƒë·ªÅu* n√≥i "Welcome to music".

S·ª≠a n√≥ ƒë·ªÉ khi b·∫°n chuy·ªÉn t·ª´ "general" sang "travel" r·ªìi sang "music" r·∫•t nhanh, b·∫°n th·∫•y hai th√¥ng b√°o, c√°i ƒë·∫ßu ti√™n l√† "Welcome to travel" v√† c√°i th·ª© hai l√† "Welcome to music". (ƒê·ªÉ th·ª≠ th√°ch th√™m, gi·∫£ s·ª≠ b·∫°n *ƒë√£* l√†m cho c√°c th√¥ng b√°o hi·ªÉn th·ªã ƒë√∫ng ph√≤ng, h√£y thay ƒë·ªïi code ƒë·ªÉ ch·ªâ th√¥ng b√°o sau c√πng ƒë∆∞·ª£c hi·ªÉn th·ªã.)

<Hint>

Effect c·ªßa b·∫°n bi·∫øt ph√≤ng n√†o n√≥ k·∫øt n·ªëi. C√≥ th√¥ng tin n√†o b·∫°n c√≥ th·ªÉ mu·ªën truy·ªÅn cho Effect Event kh√¥ng?

</Hint>

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(() => {
    showNotification('Welcome to ' + roomId, theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      setTimeout(() => {
        onConnected();
      }, 2000);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}
```

```js src/notifications.js hidden
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label { display: block; margin-top: 10px; }
```

</Sandpack>

<Solution>

B√™n trong Effect Event, `roomId` l√† gi√° tr·ªã *t·∫°i th·ªùi ƒëi·ªÉm Effect Event ƒë∆∞·ª£c g·ªçi.*

Effect Event c·ªßa b·∫°n ƒë∆∞·ª£c g·ªçi v·ªõi delay hai gi√¢y. N·∫øu b·∫°n nhanh ch√≥ng chuy·ªÉn t·ª´ ph√≤ng travel sang ph√≤ng music, v√†o th·ªùi ƒëi·ªÉm th√¥ng b√°o c·ªßa ph√≤ng travel hi·ªÉn th·ªã, `roomId` ƒë√£ l√† `"music"`. ƒê√≥ l√† l√Ω do t·∫°i sao c·∫£ hai th√¥ng b√°o ƒë·ªÅu n√≥i "Welcome to music".

ƒê·ªÉ s·ª≠a v·∫•n ƒë·ªÅ, thay v√¨ ƒë·ªçc `roomId` *m·ªõi nh·∫•t* b√™n trong Effect Event, h√£y l√†m n√≥ th√†nh tham s·ªë c·ªßa Effect Event, nh∆∞ `connectedRoomId` b√™n d∆∞·ªõi. Sau ƒë√≥ truy·ªÅn `roomId` t·ª´ Effect b·∫±ng c√°ch g·ªçi `onConnected(roomId)`:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(connectedRoomId => {
    showNotification('Welcome to ' + connectedRoomId, theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    connection.on('connected', () => {
      setTimeout(() => {
        onConnected(roomId);
      }, 2000);
    });
    connection.connect();
    return () => connection.disconnect();
  }, [roomId]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}
```

```js src/notifications.js hidden
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label { display: block; margin-top: 10px; }
```

</Sandpack>

Effect c√≥ `roomId` ƒë∆∞·ª£c set th√†nh `"travel"` (v√¨ v·∫≠y n√≥ k·∫øt n·ªëi v·ªõi ph√≤ng `"travel"`) s·∫Ω hi·ªÉn th·ªã th√¥ng b√°o cho `"travel"`. Effect c√≥ `roomId` ƒë∆∞·ª£c set th√†nh `"music"` (v√¨ v·∫≠y n√≥ k·∫øt n·ªëi v·ªõi ph√≤ng `"music"`) s·∫Ω hi·ªÉn th·ªã th√¥ng b√°o cho `"music"`. N√≥i c√°ch kh√°c, `connectedRoomId` ƒë·∫øn t·ª´ Effect c·ªßa b·∫°n (v·ªën l√† reactive), trong khi `theme` lu√¥n s·ª≠ d·ª•ng gi√° tr·ªã m·ªõi nh·∫•t.

ƒê·ªÉ gi·∫£i quy·∫øt th·ª≠ th√°ch b·ªï sung, l∆∞u ID timeout c·ªßa th√¥ng b√°o v√† x√≥a n√≥ trong cleanup function c·ªßa Effect:

<Sandpack>

```json package.json hidden
{
  "dependencies": {
    "react": "experimental",
    "react-dom": "experimental",
    "react-scripts": "latest",
    "toastify-js": "1.12.0"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test --env=jsdom",
    "eject": "react-scripts eject"
  }
}
```

```js
import { useState, useEffect } from 'react';
import { experimental_useEffectEvent as useEffectEvent } from 'react';
import { createConnection, sendMessage } from './chat.js';
import { showNotification } from './notifications.js';

const serverUrl = 'https://localhost:1234';

function ChatRoom({ roomId, theme }) {
  const onConnected = useEffectEvent(connectedRoomId => {
    showNotification('Welcome to ' + connectedRoomId, theme);
  });

  useEffect(() => {
    const connection = createConnection(serverUrl, roomId);
    let notificationTimeoutId;
    connection.on('connected', () => {
      notificationTimeoutId = setTimeout(() => {
        onConnected(roomId);
      }, 2000);
    });
    connection.connect();
    return () => {
      connection.disconnect();
      if (notificationTimeoutId !== undefined) {
        clearTimeout(notificationTimeoutId);
      }
    };
  }, [roomId]);

  return <h1>Welcome to the {roomId} room!</h1>
}

export default function App() {
  const [roomId, setRoomId] = useState('general');
  const [isDark, setIsDark] = useState(false);
  return (
    <>
      <label>
        Choose the chat room:{' '}
        <select
          value={roomId}
          onChange={e => setRoomId(e.target.value)}
        >
          <option value="general">general</option>
          <option value="travel">travel</option>
          <option value="music">music</option>
        </select>
      </label>
      <label>
        <input
          type="checkbox"
          checked={isDark}
          onChange={e => setIsDark(e.target.checked)}
        />
        Use dark theme
      </label>
      <hr />
      <ChatRoom
        roomId={roomId}
        theme={isDark ? 'dark' : 'light'}
      />
    </>
  );
}
```

```js src/chat.js
export function createConnection(serverUrl, roomId) {
  // A real implementation would actually connect to the server
  let connectedCallback;
  let timeout;
  return {
    connect() {
      timeout = setTimeout(() => {
        if (connectedCallback) {
          connectedCallback();
        }
      }, 100);
    },
    on(event, callback) {
      if (connectedCallback) {
        throw Error('Cannot add the handler twice.');
      }
      if (event !== 'connected') {
        throw Error('Only "connected" event is supported.');
      }
      connectedCallback = callback;
    },
    disconnect() {
      clearTimeout(timeout);
    }
  };
}
```

```js src/notifications.js hidden
import Toastify from 'toastify-js';
import 'toastify-js/src/toastify.css';

export function showNotification(message, theme) {
  Toastify({
    text: message,
    duration: 2000,
    gravity: 'top',
    position: 'right',
    style: {
      background: theme === 'dark' ? 'black' : 'white',
      color: theme === 'dark' ? 'white' : 'black',
    },
  }).showToast();
}
```

```css
label { display: block; margin-top: 10px; }
```

</Sandpack>

ƒêi·ªÅu n√†y ƒë·∫£m b·∫£o r·∫±ng c√°c th√¥ng b√°o ƒë√£ ƒë∆∞·ª£c l√™n l·ªãch (nh∆∞ng ch∆∞a ƒë∆∞·ª£c hi·ªÉn th·ªã) s·∫Ω b·ªã h·ªßy khi b·∫°n ƒë·ªïi ph√≤ng.

</Solution>

</Challenges>
